# CLAUDE.md

This file provides guidance to Claude Code (claude.ai/code) when working with code in this repository.

## Project Overview

Windows desktop automation tool for New World Scheduler 7.9. Automates territory data entry and PDF import using screen coordinates and simulated input.

**Technology Stack**: Python 3.10+, uv, pyautogui, pywinauto, pandas

## Commands

```bash
# Install dependencies (creates venv automatically)
uv sync

# Run automation
uv run python main.py

# Run in simulation mode (no actual execution)
uv run python main.py --dry-run

# Run in validation mode (fills fields but doesn't save, waits for user confirmation)
uv run python main.py --no-save

# Verify data files and PDFs exist
uv run python main.py --verify

# Reset progress tracking
uv run python main.py --reset

# Generate Excel template
uv run python tools/create_template.py

# Guided calibration (recommended) - saves to data/calibration.json
uv run python tools/calibration.py

# Test calibrated coordinates (hover mode)
uv run python tools/test_calibration.py

# Test with actual clicks (use with NWS open)
uv run python tools/test_calibration.py --click --pause

# Manual coordinate finder
uv run python tools/coordinate_finder.py

# Test NWS connection
uv run python tools/test_connection.py
```

## Architecture

```
main.py                          # Entry point, CLI argument parsing, orchestration
config.py                        # Loads config + calibration.json for coordinates
pyproject.toml                   # Project config and dependencies (uv)
data/
  calibration.json               # User's screen coordinates (generated by calibration.py)
  progress.json                  # Resume state for interrupted runs
territory_automation/
  automation.py                  # NWSAutomator class - pyautogui/pywinauto interaction
  data_loader.py                 # DataLoader (Excel/CSV) + ProgressTracker (JSON state)
  logger_setup.py                # Logging configuration
tools/
  calibration.py                 # Guided step-by-step coordinate calibration
  test_calibration.py            # Test calibrated coordinates (hover/click)
  coordinate_finder.py           # Free-form coordinate capture tool
  create_template.py             # Generates Excel template with example data
  test_connection.py             # Verifies pyautogui/pywinauto and NWS window
```

**Key patterns**:
- Screen coordinates loaded from `data/calibration.json` (generated by `tools/calibration.py`)
- ProgressTracker saves state to `data/progress.json` for resume capability
- Text input uses clipboard (pyperclip + Ctrl+V) to handle special characters
- Fail-safe: moving mouse to top-left corner aborts automation

## Configuration Notes

- `NWS_EXE_PATH`: Path to New World Scheduler executable
- `COORDINATES`: Dict mapping element names to (x, y) screen coordinates
- `EXCEL_COLUMNS`: Mapping between internal keys and Excel column names
- Delays are configurable for slow systems

## Data Flow

1. `DataLoader` reads Excel/CSV into DataFrame
2. `ProgressTracker` checks which territories are already processed
3. `NWSAutomator.process_territory()` fills form fields via coordinates and saves
4. Progress is saved after each territory for resume capability
